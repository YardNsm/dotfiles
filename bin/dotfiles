#!/usr/bin/env bash

# --------------------------------------------- #
# | Source all the stuff
# --------------------------------------------- #
source $DOTFILES/_setup/initializer.sh

# --------------------------------------------- #
# | Get sudo permissions
# --------------------------------------------- #
print_title "Checking for sudo permissions"
ask_for_sudo
print_result $? "I AM YOUR MASTER"
print_divider

# --------------------------------------------- #
# | Print a menu with all the topics
# --------------------------------------------- #

topics=$( find -H "$DOTFILES" -type d -maxdepth 1 -name '*' )
options=()

for topic in $topics; do

  # Check if has a 'main.sh' script
  if [[ -f $topic/main.sh ]] && [[ ! $topic == _* ]]; then
    options+=($(basename $topic))
  fi
done

PS3=$'\n  Choose a topic to execute: '
echo "  Available topics"
echo "  ------------------"
echo ""

select opt in "${options[@]}"

do
  case $opt in
    *)
      print_divider

      if [ -z $opt ]; then
        print_error "Unavailable topic"
        exit 1;
      fi

      source $DOTFILES/$opt/main.sh

      break
      ;;
  esac
done
