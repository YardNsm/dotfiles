#!/usr/bin/env bash

# Create a new draft file and open it with $EDITOR
# Examples:
#
#   $ draft
#   Will open fzf for completion
#
#   $ draft website planning
#   Will open the file `2018-09-30_website_planning.md` in $EDITOR

# ---------------------------------------------

declare -r DRAFTS_HOME="$HOME/dev/gitlab/knowledge/drafts/"

main() {
  local file

  if [[ $# -eq 0 ]]; then
    file="$(find "$DRAFTS_HOME" -name '*.md' -exec basename {} \; | fzf)"

    [[ -n "$file" ]] \
      && $EDITOR "$DRAFTS_HOME/$file"

    return 0
  fi

  # If there is an exact file, open it
  [[ -f "$DRAFTS_HOME/$1" ]] \
    && $EDITOR "$DRAFTS_HOME/$1" \
    && return 0

  local -r date_fmt="$(date +%Y-%m-%d)"
  local -r name_fmt=$(sed 's/ /_/g' <<< "$@")

  $EDITOR "$DRAFTS_HOME/${date_fmt}_${name_fmt}.md"
}

main "$@"
