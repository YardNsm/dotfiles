#!/usr/bin/env bash

# ---------------------------------------------

source $DOTFILES/_setup/initializer.sh

list_tasks() {

  print_title "Getting ready"
  check_for_sudo

  topics=$(find -H "$DOTFILES" -type d -maxdepth 1 -name '*')
  options=()
  os=$(get_os)

  for topic in $topics; do
    if [[ -f $topic/install.sh ]] || [[ -f $topic/install-$os.sh ]] && [[ ! $topic == _* ]]; then
      options+=($(basename $topic))
    fi
  done

  PS3=$'\n  Choose a topic to install: '

  print_title "Available topics\n"

  select opt in "${options[@]}"; do
    case $opt in
      *)

        if [ -z $opt ]; then
          print_error "Unavailable topic"
          exit 1;
        fi

        print_title "Running topic: '$opt'"
        source $DOTFILES/$opt/install.sh

        break
        ;;
    esac
  done
}

# ---------------------------------------------

case "$1" in
  "--install" ) . $DOTFILES/install.sh        ;;
  "--tasks" )   list_tasks                    ;;
  * )
    echo "Usage: dotsetup [OPTIONS]                  "
    echo "  Installs the dotfiles                    "
    echo "                                           "
    echo "Options:                                   "
    echo "  --install         Runs the install script"
    echo "  --tasks           Lists all tasks and    "
    echo "  -h, --help        Show this output       "
    echo "                                           "
    exit 0
    ;;
esac
