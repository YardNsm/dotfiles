#!/usr/bin/env bash

# ---------------------------------------------

source "$DOTFILES/_setup/initializer.sh"

# ---------------------------------------------

list_tasks() {

  print_title "Getting ready"
  check_for_sudo

  local topics=( $(get_all_topics) )
  local options=()

  local os
  os=$(get_os)

  for topic in "${topics[@]}"; do
    if [[ -f $topic/install.sh ]] || [[ -f $topic/install-$os.sh ]]; then
      options+=( $(basename "$topic") )
    fi
  done

  PS3=$'\n  Choose a topic to install: '

  print_title "Available topics\n"

  select opt in "${options[@]}"; do
    case $opt in
      *)

        if [ -z $opt ]; then
          print_error "Unavailable topic"
          exit 1;
        fi

        install_specific_topic "$opt"
        exit 0
        ;;
    esac
  done
}

# ---------------------------------------------

print_help() {
  echo "Usage: dotsetup [OPTIONS]                  "
  echo "  Installs the dotfiles                    "
  echo "                                           "
  echo "Options:                                   "
  echo "  --install         Runs the install script"
  echo "  --tasks           Lists all tasks and    "
  echo "  -h, --help        Show this output       "
  echo "                                           "
}

# ---------------------------------------------

main() {
  case "$1" in
    "--install" )
      shift
      source "$DOTFILES/install.sh" "$@"
      ;;
    "--tasks" )
      list_tasks
      exit 0
      ;;
    * )
      print_help
      exit 0
      ;;
  esac
}

main "$@"
